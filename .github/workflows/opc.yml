name: OPC UA tests

on:
  push:
    paths:
      - 'src/**'
      - 'tests/**'
      - '.github/workflows/opc.yml'
  pull_request:
    paths:
      - 'src/**'
      - 'tests/**'

jobs:
  opc-ua-matrix:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        python-version: [3.11]
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}
      - name: Install deps (opc extra)
        run: |
          python -m pip install --upgrade pip
          pip install -e .[opc,dev]
      - name: Run OPC tests
        run: |
          pytest -q -k "opc" -q

  windows-smoke:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.11
      - name: Install minimal deps
        run: pip install -e .[dev]
      - name: Lint (fast)
        run: pytest -q -k "not opc" -q -q --maxfail=1
